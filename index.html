<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>æ¾è”­å¤§å­¦çœ‹è­·å­¦éƒ¨ã€€çœ‹è­·é–¢ä¿‚æ³•ä»¤</title>
  <style>
    :root{
      --cover-bg:#FFF9C4; /* è–„ã„é»„è‰² */
      --ink:#222; --muted:#6b7280; --card:#fff; --radius:20px;
      --wrong:#dc2626; --correct:#16a34a;
      --pending:#dbeafe; --pending-ring:rgba(37,99,235,.35);
      --title-color:#38bdf8; /* æ°´è‰² */
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",Helvetica,Arial;
      margin:0;background:#f8fafc;color:var(--ink)}
    .wrap{min-height:100vh;display:flex}
    .container{flex:1;display:flex;align-items:stretch;justify-content:center;padding:16px}
    .stage{width:100%;max-width:860px;display:grid}
    .screen{display:none}.screen.active{display:grid}

    /* Cover */
    .cover{background:var(--cover-bg);border-radius:var(--radius);
      box-shadow:0 4px 16px rgba(0,0,0,.1);border:1px solid rgba(0,0,0,.06);
      padding:clamp(20px,6vw,48px);display:flex;flex-direction: column;justify-content: space-evenly;align-items: center;min-height: calc(100vh - 32px);}
    .title{font-size:clamp(26px,6.5vw,38px);font-weight:800;margin:0;text-align:center;
      color:var(--title-color);line-height:1.5}
    .title span{display:block}

    .stamp-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:clamp(18px,4.5vw,28px);
      background:rgba(255,255,255,.7);border:1px dashed rgba(0,0,0,.15);border-radius:12px;
      padding:clamp(20px,5vw,28px)}
    .stamp{font-size:clamp(24px,7vw,40px);text-align:center;filter:grayscale(1) opacity(.35);transition:.2s}
    .stamp.active{filter:none;transform:scale(1.05)}

    .lesson-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:clamp(16px,5vw,28px)}
    @media (min-width:640px){.lesson-buttons{grid-template-columns:repeat(4,1fr)}}
    .btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;
      background:var(--card);padding:clamp(18px,5vw,28px);border-radius:12px;border:1px solid rgba(0,0,0,.08);
      box-shadow:0 2px 8px rgba(0,0,0,.06);font-weight:700;cursor:pointer;text-decoration:none;text-align:center;
      font-size:clamp(16px,5vw,20px);min-height:70px}
    .btn:hover{background:#f9fafb}
    .btn:disabled{background:#e5e7eb;cursor:not-allowed;color:#9ca3af}

    /* Panels */
    .panel{background:#fff;border-radius:var(--radius);box-shadow:0 4px 16px rgba(0,0,0,.08);
      border:1px solid rgba(0,0,0,.06);padding:clamp(16px,4vw,28px);min-height:calc(100vh - 32px);
      display:grid;grid-template-rows:auto 1fr auto;row-gap:clamp(12px,3vw,20px)}
    .crumbs{font-size:clamp(13px,3vw,15px);margin-bottom:6px;color:var(--muted)}
    .panel h2{margin:0 0 8px;font-size:clamp(20px,5vw,26px)}

    .question{padding:12px;border-radius:10px;margin-bottom:10px;background:#f9fafb}
    .options{display:flex;gap:12px;margin-top:8px}
    .opt-btn{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,.15);background:#fff;cursor:pointer;font-weight:700;text-align:center}
    .opt-btn.clicked{background:var(--pending);outline:2px solid var(--pending-ring)}
    .opt-btn.wrong{background:var(--wrong);color:#fff}
    .opt-btn.correct{background:var(--correct);color:#fff}

    .review-line{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:10px}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#ecfdf5;color:#065f46;font-weight:800;border:1px solid #a7f3d0;font-size:13px}
    .btn[aria-disabled="true"] {opacity: .5;cursor: not-allowed;pointer-events: none;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="container">
      <div class="stage">

        <!-- Cover -->
        <section id="cover" class="screen active">
          <div class="cover">
            <h1 class="title">
              <span>æ¾è”­å¤§å­¦çœ‹è­·å­¦éƒ¨</span>
              <span>çœ‹è­·é–¢ä¿‚æ³•ä»¤</span>
            </h1>

            <div class="stamp-grid" id="stampRow"></div>

            <div class="lesson-buttons" id="lessonGrid"></div>
            <div class="review-line">
              <button id="reviewBtn" class="btn">ğŸ“š ç·å¾©ç¿’ãƒšãƒ¼ã‚¸ã¸</button>
              <span id="reviewBadge" class="badge" style="display:none;">100%é”æˆğŸŒ¸</span>
            </div>
          </div>
        </section>

        <!-- Lesson -->
        <section id="lesson" class="screen">
          <div class="panel">
            <div>
              <div class="crumbs">â† <a href="#" id="backLink">è¡¨ç´™ã«ã‚‚ã©ã‚‹</a></div>
              <h2 id="lessonTitle"></h2>
            </div>
            <div id="lessonBody"></div>
          </div>
        </section>

        <!-- Review -->
        <section id="review" class="screen">
          <div class="panel">
            <div>
              <div class="crumbs">â† <a href="#" id="backLink2">è¡¨ç´™ã«ã‚‚ã©ã‚‹</a></div>
              <h2>ç·å¾©ç¿’ãƒšãƒ¼ã‚¸ï¼ˆ40å•ï¼‰</h2>
            </div>
            <div id="reviewBody"></div>
          </div>
        </section>

      </div>
    </div>
  </div>

  <script>
    /* ===== è¨­å®š ===== */
    const TOTAL = 8;
    const STORAGE_KEY = 'nursingLawProgress.v22'; // åŒã˜ç«¯æœ«ã§é€²æ—ä¿æŒ
    const normalize = s => (s === 'â—‹') ? 'ã€‡' : s;

    /* ===== çŠ¶æ…‹ãƒ­ãƒ¼ãƒ‰ ===== */
    let progress = loadProgress();
    let answersRecord = loadAnswers();
    let flags = loadFlags();

    /* ===== DOM å‚ç…§ ===== */
    const stampRow = document.getElementById('stampRow');
    const lessonGrid = document.getElementById('lessonGrid');
    const cover = document.getElementById('cover');
    const lesson = document.getElementById('lesson');
    const review = document.getElementById('review');
    const reviewBtn = document.getElementById('reviewBtn');
    const reviewBadge = document.getElementById('reviewBadge');

    /* ===== å•é¡Œ & é…ä¿¡ï¼ˆJST+09:00ï¼‰ ===== */
    const sessions = [
      { release: new Date('2025-09-22T13:05:00+09:00'), questions: [
        { q:'æ—¥æœ¬ã®æ³•ã®å¤§éƒ¨åˆ†ã¯æ–‡å­—ã§è¡¨ã™ã“ã¨ãŒã§ãã‚‹æˆæ–‡æ³•ã§ã‚ã‚‹', ans:'ã€‡' },
        { q:'ä¿å¥å¸«åŠ©ç”£å¸«çœ‹è­·å¸«æ³•ã¯å…¬æ³•ã§ã‚ã‚Šã€å®Ÿä½“æ³•ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'æ³•ã®ã†ã¡æ†²æ³•ã¯å”¯ä¸€æœ€é«˜ã®ã‚‚ã®ã§ã‚ã‚‹', ans:'ã€‡' },
        { q:'ä¿å¥å¸«åŠ©ç”£å¸«çœ‹è­·å¸«æ³•ã¯ä¿å¥è¡›ç”Ÿæ³•ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'çœ‹è­·è¡Œæ”¿ã«ã¤ã„ã¦ã¯åŒ»æ”¿å±€ã®çœ‹è­·èª²ãŒæ‹…å½“ã—ã¦ã„ã‚‹', ans:'ã€‡' },
      ]},
      { release: new Date('2025-09-29T13:05:00+09:00'), questions: [
        { q:'çœ‹è­·å¸«å…è¨±ã‚’ä»˜ä¸ã™ã‚‹ã®ã¯éƒ½é“åºœçœŒçŸ¥äº‹ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'ä¿å¥å¸«ã¯åç§°ç‹¬å ã§ã‚ã‚‹', ans:'ã€‡' },
        { q:'æ¥­å‹™å¾“äº‹è€…å±Šã¯2å¹´ã”ã¨ã«éƒ½é“åºœçœŒçŸ¥äº‹ã«å±Šã‘å‡ºã‚‹', ans:'ã€‡' },
        { q:'çœ‹è­·å¸«ãƒ»ä¿å¥å¸«ãƒ»å‡†çœ‹è­·å¸«ã®å®ˆç§˜ç¾©å‹™ã¯åˆ‘æ³•ã«å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹', ans:'âœ•' },
        { q:'éƒ½é“åºœçœŒãƒŠãƒ¼ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã®äº‹æ¥­ã¨ã—ã¦è¨ªå•çœ‹è­·æ¥­å‹™ãŒã‚ã‚‹', ans:'âœ•' },
      ]},
      { release: new Date('2025-10-06T13:05:00+09:00'), questions: [
        { q:'åŒ»ç™‚æ³•ã¯åŒ»ç™‚æä¾›ã®ç†å¿µã‚’å®šã‚ã¦ã„ã‚‹', ans:'ã€‡' },
        { q:'æˆç”£æ‰€ã¯åŒ»ç™‚æ³•ã«åŸºã¥ãåŒ»ç™‚æä¾›æ–½è¨­ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'åŒ»ç™‚äº‹æ•…ãŒç™ºç”Ÿã—ãŸå ´åˆã«ã¯åŒ»ç™‚å®‰å…¨æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼ã¸å ±å‘Šã™ã‚‹', ans:'âœ•' },
        { q:'åŒ»ç™‚è¨ˆç”»ã¯éƒ½é“åºœçœŒãŒå®šã‚ã‚‹', ans:'ã€‡' },
        { q:'è‡“å™¨ã®ç§»æ¤ã«é–¢ã™ã‚‹æ³•å¾‹ã«ãŠã„ã¦è„³æ­»è‡“å™¨æä¾›ãŒå¯èƒ½ã«ãªã‚‹ã®ã¯15æ­³ã‹ã‚‰ã§ã‚ã‚‹', ans:'âœ•' },
      ]},
      { release: new Date('2025-10-20T13:05:00+09:00'), questions: [
        { q:'åŒ»å¸«æ³•ã«ãŠã„ã¦ç›¸å¯¾çš„æ¬ æ ¼äº‹ç”±ã¯æœªæˆå¹´è€…ã§ã‚ã‚‹ã“ã¨', ans:'âœ•' },
        { q:'è¨ºæ–­æ›¸ã®äº¤ä»˜ã¯åŒ»å¸«ã‚ã‚‹ã„ã¯æ­¯ç§‘åŒ»å¸«ã«ã—ã‹ã§ããªã„', ans:'ã€‡' },
        { q:'è–¬å‰¤å¸«ã¯å‡¦æ–¹ç®‹ã®å†…å®¹ã‚’å‡¦æ–¹ã—ãŸåŒ»å¸«ç­‰ã«ç¢ºèªã›ãšã«å¤‰æ›´ã§ãã‚‹', ans:'âœ•' },
        { q:'è¨ºç™‚æ”¾å°„ç·šæŠ€å¸«ã¯ã‚¨ãƒƒã‚¯ã‚¹ç·šå†™çœŸã«åŸºã¥ãè¨ºæ–­ãŒã§ãã‚‹', ans:'âœ•' },
        { q:'ä»‹è­·ç¦ç¥‰å£«ã¯ä¸€å®šã®æ¡ä»¶ã‚’æº€ãŸã™å ´åˆã«å–€ç—°å¸å¼•ã‚’å®Ÿæ–½ã§ãã‚‹', ans:'ã€‡' },
      ]},
      { release: new Date('2025-10-27T13:05:00+09:00'), questions: [
        { q:'éº»è–¬ã¯åŒ»è–¬å“åŒ»ç™‚æ©Ÿå™¨ç­‰æ³•ã«ã‚ˆã‚‹è¦åˆ¶å¯¾è±¡ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'å±é™ºãƒ‰ãƒ©ãƒƒã‚°ç­‰ã¯æŒ‡å®šè–¬ç‰©ã«è©²å½“ã™ã‚‹', ans:'ã€‡' },
        { q:'åŠ‡è–¬ã®å®¹å™¨ã«ã¯é»’å­—ã«ç™½æ ãƒ»ç™½åœ°ã§å“åã¨ã€ŒåŠ‡ã€ã®æ–‡å­—ã‚’è¡¨ç¤ºã™ã‚‹', ans:'âœ•' },
        { q:'è–¬å±€ã®é–‹è¨­ã¯å¸‚ç”ºæ‘ã®è¨±å¯ã‚’ã†ã‘ã‚‹', ans:'âœ•' },
        { q:'è–¬å‰¤å¸«ã¯éº»è–¬æ–½ç”¨è€…ã®å…è¨±ã‚’å–å¾—ã§ããªã„', ans:'ã€‡' },
      ]},
      { release: new Date('2025-11-10T13:05:00+09:00'), questions: [
        { q:'æ¯å­ä¿å¥æ³•ã«åŸºã¥ãå±Šã‘å‡ºã¯å‡ºç”Ÿå±Šã§ã‚ã‚‹', ans:'âœ•' },
        { q:'æ¯ä½“ä¿è­·æ³•ã«ã¯å—èƒèª¿ç¯€ã®å®Ÿæ–½æŒ‡å°ã«ã¤ã„ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹', ans:'ã€‡' },
        { q:'å…ç«¥ç›¸è«‡æ‰€ã¯æ¯è¦ªã‚’ä¸€æ™‚ä¿è­·ã™ã‚‹æ©Ÿèƒ½ã‚’ã‚‚ã¤', ans:'âœ•' },
        { q:'éšœå®³è€…åŸºæœ¬æ³•ã®ç›®çš„ã¯éšœå®³è€…ã®ä¿è­·ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'éšœå®³è€…ç·åˆæ”¯æ´æ³•ã®ä»‹è­·çµ¦ä»˜è²»ã¯å¸‚ç”ºæ‘ã®æ”¯çµ¦æ±ºå®šã‚’å—ã‘ãªã‘ã‚Œã°ãªã‚‰ãªã„', ans:'ã€‡' },
      ]},
      { release: new Date('2025-11-17T13:05:00+09:00'), questions: [
        { q:'å¾ŒæœŸé«˜é½¢è€…åŒ»ç™‚ä¿é™ºåˆ¶åº¦ã®ä¿é™ºè€…ã¯å¾ŒæœŸé«˜é½¢è€…åŒ»ç™‚åºƒåŸŸé€£åˆã§ã‚ã‚‹', ans:'ã€‡' },
        { q:'ä»‹è­·ä¿é™ºã®ç¬¬ä¸€å·è¢«ä¿é™ºè€…ã¯40æ­³ä»¥ä¸Šã®è€…ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'è¦ä»‹è­·èªå®šã¯ä¸»æ²»åŒ»æ„è¦‹æ›¸ã¨èªå®šèª¿æŸ»ã‚’åŸºã«ä»‹è­·èªå®šå¯©æŸ»ä¼šã§åˆ¤å®šã•ã‚Œã‚‹', ans:'ã€‡' },
        { q:'åˆ©ç”¨è€…è² æ‹…ã¯ã™ã¹ã¦ã®äººãŒä¸€å¾‹3å‰²ã§ã‚ã‚‹', ans:'âœ•' },
        { q:'åœ°åŸŸåŒ…æ‹¬æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼ã¯éƒ½é“åºœçœŒãŒè¨­ç½®ã™ã‚‹', ans:'âœ•' },
      ]},
      { release: new Date('2025-12-01T13:05:00+09:00'), questions: [
        { q:'åŠ´åƒåŸºæº–æ³•ã«ãŠã‘ã‚‹æ³•å®šåŠ´åƒæ™‚é–“ã¯ã€1æ—¥8æ™‚é–“ãƒ»é€±40æ™‚é–“ã§ã‚ã‚‹', ans:'ã€‡' },
        { q:'åŠ´åƒå®‰å…¨è¡›ç”Ÿæ³•ã«ãŠã„ã¦äº‹æ¥­è€…ã¯åŠ´åƒè€…ã«å¯¾ã—å¹´1å›ä»¥ä¸Šã®å®šæœŸå¥åº·è¨ºæ–­ã‚’è¡Œã†ç¾©å‹™ãŒã‚ã‚‹', ans:'ã€‡' },
        { q:'é€šå‹¤é€”ä¸Šã®ç½å®³ã¯åŠ´ç½ä¿é™ºã®å¯¾è±¡ã«ãªã‚‰ãªã„', ans:'âœ•' },
        { q:'ç”·å¥³é›‡ç”¨æ©Ÿä¼šå‡ç­‰æ³•ã§ã¯å‹Ÿé›†ãƒ»æ¡ç”¨ã«ãŠã„ã¦ã€æ€§åˆ¥ã‚’ç†ç”±ã«å·®åˆ¥ã—ã¦ã¯ãªã‚‰ãªã„ã€‚', ans:'ã€‡' },
        { q:'è‚²å…ãƒ»ä»‹è­·ä¼‘æ¥­æ³•ã«ãŠã„ã¦è‚²å…ä¼‘æ¥­ã¯å­ãŒ3æ­³ã«ãªã‚‹ã¾ã§å¿…ãšå–å¾—ã§ãã‚‹', ans:'âœ•' },
      ]},
    ];

    /* ===== LocalStorage I/O ===== */
    function loadProgress(){
      try{const raw=localStorage.getItem(STORAGE_KEY);
        if(!raw) return Array(TOTAL).fill(false);
        const arr=JSON.parse(raw); if(Array.isArray(arr)&&arr.length===TOTAL) return arr.map(Boolean);
      }catch{}
      return Array(TOTAL).fill(false);
    }
    function loadAnswers(){ try{const raw=localStorage.getItem(STORAGE_KEY+"_answers"); if(!raw) return {}; return JSON.parse(raw);}catch{} return {}; }
    function loadFlags(){ try{const raw=localStorage.getItem(STORAGE_KEY+"_flags"); if(!raw) return {reviewPerfect:false}; return JSON.parse(raw);}catch{} return {reviewPerfect:false}; }
    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
      localStorage.setItem(STORAGE_KEY+"_answers", JSON.stringify(answersRecord));
      localStorage.setItem(STORAGE_KEY+"_flags", JSON.stringify(flags));
      render();
    }

    /* ===== Cover Rendering ===== */
    function renderStamps(){
      stampRow.innerHTML='';
      for(let i=0;i<TOTAL;i++){
        const span=document.createElement('span');
        span.className='stamp'+(progress[i]?' active':'');
        span.textContent='ğŸ’®';
        stampRow.appendChild(span);
      }
    }
    function renderButtons(){
      lessonGrid.innerHTML='';
      const now=new Date();
      for(let i=0;i<TOTAL;i++){
        const a=document.createElement('a');
        a.className='btn';
        a.textContent=`ğŸ“˜ ç¬¬${i+1}å›`;
        const released=!sessions[i].release || now>=sessions[i].release;
        if(!released) {
      a.setAttribute('aria-disabled','true'); }else{
      a.href='#';
      a.addEventListener('click',(e)=>{e.preventDefault();openLesson(i);});
    }
    lessonGrid.appendChild(a);
  }
}
    function renderReviewButton(){
      // ç·å¾©ç¿’ã¯ 8å›ã™ã¹ã¦ğŸ’®ï¼ˆ= å…¨å•å›ç­”ï¼‰ã§æœ‰åŠ¹åŒ–
      reviewBtn.disabled=!progress.every(Boolean);
      reviewBadge.style.display = flags.reviewPerfect ? 'inline-flex' : 'none';
    }

    /* ===== Lesson Screen ===== */
    function openLesson(idx){
      const now=new Date();
      const released=!sessions[idx].release || now>=sessions[idx].release;
      if(!released){ alert('ã“ã®å›ã¯ã¾ã é…ä¿¡å‰ã§ã™ã€‚å…¬é–‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚'); return; }

      cover.classList.remove('active'); lesson.classList.add('active');
      document.getElementById('lessonTitle').textContent=`ç¬¬${idx+1}å›ï¼šã€‡âœ•å•é¡Œï¼ˆ5å•ï¼‰`;
      const body=document.getElementById('lessonBody'); body.innerHTML='';

      const prev=answersRecord[idx]||{};
      sessions[idx].questions.forEach((item,qi)=>{
        const div=document.createElement('div'); div.className='question';
        div.innerHTML=`<p>${qi+1}. ${item.q}</p>`;
        const opts=document.createElement('div'); opts.className='options';
        ['ã€‡','âœ•'].forEach(opt=>{
          const btn=document.createElement('button'); btn.className='opt-btn'; btn.textContent=opt;
          if(prev[qi] && opt===normalize(prev[qi])) btn.classList.add('clicked');
          btn.addEventListener('click',()=>{
            opts.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('clicked','wrong','correct'));
            btn.classList.add('clicked');
          });
          opts.appendChild(btn);
        });
        div.appendChild(opts); body.appendChild(div);
      });

      const complete=document.createElement('button');
      complete.className='btn'; complete.textContent='ğŸ’® å®Œäº†ï¼ˆåˆ¤å®šï¼‰';
      complete.onclick=()=>{
        const rec={}; const qs=body.querySelectorAll('.question'); let answered=0;
        let allCorrect=true;
        qs.forEach((qDiv,qi)=>{
          const chosen=qDiv.querySelector('.opt-btn.clicked');
          const correctAns=sessions[idx].questions[qi].ans;
          qDiv.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('wrong','correct'));
          if(chosen){
            answered++; rec[qi]=chosen.textContent;
            if(normalize(chosen.textContent)===normalize(correctAns)) chosen.classList.add('correct');
            else { chosen.classList.add('wrong'); allCorrect=false; }
          }else{ allCorrect=false; }
        });
        answersRecord[idx]=rec;
        // æœ¬ç·¨ã‚¹ã‚¿ãƒ³ãƒ—æ¡ä»¶ï¼šå„å›ã®å…¨å•ã«å›ç­”ã§ğŸ’®ï¼ˆä¸€åº¦ä»˜ã„ãŸã‚‰ä¿æŒï¼‰
        progress[idx]=progress[idx] || (answered===sessions[idx].questions.length);
        save();
      };
      body.appendChild(complete);

      document.getElementById('backLink').onclick=(e)=>{e.preventDefault();backToCover();};
    }

    /* ===== Review Screen ===== */
    function openReview(){
      if(reviewBtn.disabled) return; // å…¨8å›å®Œäº†å‰ã¯é–‹ã‘ãªã„
      cover.classList.remove('active'); review.classList.add('active');
      const body=document.getElementById('reviewBody'); body.innerHTML='';

      // 8å›Ã—5å• = 40å•ï¼ˆæ¯å›ãƒ©ãƒ³ãƒ€ãƒ é †ï¼‰
      let problems=sessions.flatMap(s=>s.questions).map((q,i)=>({...q, idx:i+1}));
      problems=problems.sort(()=>Math.random()-0.5);

      problems.forEach((item,i)=>{
        const div=document.createElement('div'); div.className='question';
        div.innerHTML=`<p>${i+1}. ${item.q}</p>`;
        const opts=document.createElement('div'); opts.className='options';
        ['ã€‡','âœ•'].forEach(opt=>{
          const btn=document.createElement('button'); btn.className='opt-btn'; btn.textContent=opt;
          btn.addEventListener('click',()=>{
            opts.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('clicked','wrong','correct'));
            btn.classList.add('clicked');
          });
          opts.appendChild(btn);
        });
        div.appendChild(opts); body.appendChild(div);
      });

      const complete=document.createElement('button');
      complete.className='btn'; complete.textContent='ğŸ’® åˆ¤å®šï¼ˆ40å•ï¼‰';
      complete.onclick=()=>{
        const qs=body.querySelectorAll('.question'); let answered=0; let allCorrect=true;
        qs.forEach((qDiv,qi)=>{
          const chosen=qDiv.querySelector('.opt-btn.clicked');
          const correctAns=problems[qi].ans;
          qDiv.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('wrong','correct'));
          if(chosen){
            answered++;
            if(normalize(chosen.textContent)===normalize(correctAns)) chosen.classList.add('correct');
            else { chosen.classList.add('wrong'); allCorrect=false; }
          } else { allCorrect=false; }
        });
        if(answered===problems.length && allCorrect){
          flags.reviewPerfect=true; save();
          alert('ç·å¾©ç¿’ 100% é”æˆï¼ğŸŒ¸\nã‚«ãƒãƒ¼ã«ãƒãƒƒã‚¸ã‚’è¡¨ç¤ºã—ã¾ã—ãŸã€‚');
        }
      };
      body.appendChild(complete);

      document.getElementById('backLink2').onclick=(e)=>{e.preventDefault();backToCover();};
    }

    /* ===== å…±é€š ===== */
    function backToCover(){ lesson.classList.remove('active'); review.classList.remove('active'); cover.classList.add('active'); render(); }
    function render(){ renderStamps(); renderButtons(); renderReviewButton(); }

    // åˆæœŸåŒ–
    reviewBtn.addEventListener('click', openReview);
    render();
  </script>
</body>
</html>
